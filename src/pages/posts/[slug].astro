---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const posts = await getCollection('posts');
const post = posts.find((p) => p.slug === slug);

if (!post) {
  throw new Error(`Post with slug ${slug} not found`);
}
---

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{post.data.title}</title>
</head>
<body>
  <h1>{post.data.title}</h1>
  <p>{new Date(post.data.pubDate).toLocaleDateString()}</p>

  {post.data.image && (
    <img src={post.data.image.url} alt={post.data.image.alt} />
  )}

  <article>
    {post.body}
  </article>
</body>
</html>